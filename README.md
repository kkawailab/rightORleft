# Right or Left 投票システム

教育用のリアルタイム投票システムです。教員が2択の質問を提示し、学生がオンラインで投票、結果をリアルタイムで表示できます。

## 概要

Right or Left は、教育現場でのインタラクティブな授業を支援するWebアプリケーションです。教員が提示する選択肢に対して、学生がリアルタイムで投票を行い、その結果を即座に可視化することで、授業への参加意欲を高め、理解度の確認や意見の集約を効率的に行うことができます。

### 主な特徴

- **即座性**: WebSocketによるリアルタイム通信で投票結果が瞬時に反映
- **シンプル**: 複雑な操作は一切不要、直感的なUI設計
- **アクセシビリティ**: PC・スマートフォン・タブレットなど、あらゆるデバイスに対応
- **信頼性**: 重複投票防止機能と自動再接続で安定した運用
- **スタンドアロン**: インターネット不要、ローカルネットワークで完結

## 機能

- **教員用コントロール画面**
  - 投票の開始・停止
  - リアルタイムでの投票数確認
  - 結果の表示（グラフ表示）
  - 投票のリセット

- **学生用投票画面**
  - シンプルな投票インターフェース（左側 or 右側）
  - 投票確認
  - 結果の閲覧
  - 重複投票の防止

- **リアルタイム通信**
  - WebSocketによる即座の更新
  - 複数ユーザーの同時接続対応
  - 自動再接続機能

## セットアップ

### オプション1: クラウドデプロイ（推奨）

インターネット経由でどこからでもアクセスしたい場合は、**Render**へのデプロイが最も簡単です：

#### Renderへのデプロイ手順

1. **https://render.com** でGitHubアカウントでサインアップ
2. 「New +」→「Web Service」を選択
3. このリポジトリを接続
4. 以下の設定で作成：
   - Build Command: `npm install`
   - Start Command: `npm start`
   - Instance Type: **Free**（無料プラン）

5〜10分でデプロイ完了。生成されたURLにアクセスするだけで使用開始できます。

**📘 詳細な手順は [DEPLOYMENT.md](./DEPLOYMENT.md) を参照してください**

#### Renderの特徴
- ✅ 完全無料（クレジットカード不要）
- ✅ 自動SSL証明書（HTTPS対応）
- ✅ 自動デプロイ（git pushで更新）
- ⚠️ 15分未使用でスリープ（再起動に30〜60秒）

---

### オプション2: VPSデプロイ（上級者向け）

常時稼働やサーバー管理の学習が必要な場合は、VPS（Virtual Private Server）へのデプロイも可能です：

- **対象サービス**: Digital Ocean、Vultr、AWS Lightsail等
- **月額コスト**: $2.50〜6
- **メリット**: 常時稼働、完全制御、複数アプリホスト可能
- **デメリット**: サーバー管理が必要、初期設定が複雑

**📘 詳細な手順は [DEPLOYMENT_VPS.md](./DEPLOYMENT_VPS.md) を参照してください**

---

### オプション3: ローカル実行

ローカルネットワーク内でのみ使用する場合：

#### 必要要件

- Node.js (v14以上推奨)
- npm

#### インストール

```bash
npm install
```

#### 起動

```bash
npm start
```

サーバーが起動したら、以下のURLにアクセスできます：

- トップページ: http://localhost:3000
- 教員用画面: http://localhost:3000/presenter
- 学生用画面: http://localhost:3000/student

## 使い方

1. **教員側の準備**
   - `/presenter` にアクセス
   - 「投票開始」ボタンをクリック

2. **学生側の操作**
   - `/student` にアクセス
   - 投票が開始されたら「左側」または「右側」を選択

3. **結果の表示**
   - 教員画面で「結果表示」ボタンをクリック
   - 全員の画面に投票結果が表示されます

4. **次の投票へ**
   - 「リセット」ボタンで投票をクリア
   - 再度「投票開始」で新しい投票を開始

## 技術仕様

### アーキテクチャ

本システムは、クライアント・サーバー型のWebアプリケーションとして設計されています。

```
┌─────────────┐         WebSocket          ┌─────────────┐
│   教員用    │◄─────────────────────────►│             │
│  クライアント│                            │             │
└─────────────┘                            │             │
                                           │   Node.js   │
┌─────────────┐         WebSocket          │   Server    │
│  学生用     │◄─────────────────────────►│             │
│ クライアント │                            │  (server.js)│
└─────────────┘                            │             │
       │                                   └─────────────┘
       │                                          │
       └──────── localStorage ──────────┐         │
                 (studentId)             │    投票状態管理
                                        │    ・active flag
                                        │    ・vote counts
                                        │    ・voter Set
```

### 技術スタック

#### バックエンド
- **Node.js** (v14以上推奨): サーバーサイドランタイム
- **Express** (v4.18.2): Webアプリケーションフレームワーク
- **ws** (v8.14.2): WebSocketライブラリ

#### フロントエンド
- **HTML5**: セマンティックマークアップ
- **CSS3**: レスポンシブデザイン、Flexbox、グラデーション、アニメーション
- **JavaScript (ES6+)**: Vanilla JavaScript、WebSocket API、localStorage API

### データフロー

#### 1. 投票開始フロー
```
教員: [投票開始] → Server → Broadcast → 全クライアント: [投票受付中]
```

#### 2. 投票フロー
```
学生: [投票] → Server →
  ├─ 学生: [投票確認]
  └─ 教員: [投票数更新]
```

#### 3. 結果表示フロー
```
教員: [結果表示] → Server → Broadcast → 全クライアント: [結果グラフ]
```

### WebSocketメッセージ仕様

#### クライアント → サーバー

| メッセージタイプ | パラメータ | 説明 |
|----------------|----------|------|
| `register_presenter` | - | 教員として登録 |
| `register_student` | `studentId` | 学生として登録 |
| `start_voting` | - | 投票セッション開始 |
| `vote` | `choice: "left"\|"right"` | 投票送信 |
| `show_results` | - | 結果表示開始 |
| `reset` | - | 投票リセット |

#### サーバー → クライアント

| メッセージタイプ | パラメータ | 説明 |
|----------------|----------|------|
| `state_update` | `state: Object` | 現在の投票状態 |
| `voting_started` | - | 投票開始通知 |
| `vote_confirmed` | `choice: String` | 投票受付確認 |
| `vote_update` | `leftCount, rightCount, totalVotes` | 投票数更新（教員のみ） |
| `results` | `leftCount, rightCount, totalVotes` | 結果表示 |
| `reset` | - | リセット通知 |
| `error` | `message: String` | エラーメッセージ |

### セキュリティ機能

- **重複投票防止**:
  - クライアント側: localStorage にユニークID保存
  - サーバー側: Set データ構造で投票者を追跡
- **ロール制御**: 教員のみが投票の開始・結果表示・リセット可能
- **接続管理**: WebSocket の readyState チェックによる安全な送信

### パフォーマンス最適化

- **効率的なブロードキャスト**: 教員・学生でクライアントを分離管理
- **最小限のデータ転送**: JSON 形式の軽量メッセージ
- **CSSアニメーション**: GPU アクセラレーションによるスムーズなUI

## ファイル構成

```
rightORleft/
├── server.js              # サーバーアプリケーション
├── package.json           # 依存関係の定義
├── public/                # 静的ファイル
│   ├── index.html        # トップページ
│   ├── presenter.html    # 教員用画面
│   └── student.html      # 学生用画面
├── RPD.md                # 要件定義書
├── CLAUDE.md             # 開発ガイド
└── README.md             # このファイル
```

## カスタマイズ

### ポート番号の変更

環境変数 `PORT` を設定することで、ポート番号を変更できます：

```bash
PORT=8080 npm start
```

### デザインのカスタマイズ

各HTMLファイルの `<style>` セクションを編集することで、デザインをカスタマイズできます。

## トラブルシューティング

### 接続できない場合

- サーバーが正しく起動しているか確認
- ファイアウォール設定を確認
- ブラウザのコンソールでエラーを確認

### 投票が反映されない場合

- WebSocket接続状態を確認（画面上部の接続ステータス）
- ページをリロードして再接続

## 更新履歴

### Version 1.1.0 (2025-11-05)

#### クラウドデプロイ対応

**新機能:**
- ✅ Renderへのデプロイ対応
  - `render.yaml` 設定ファイル追加
  - `DEPLOYMENT.md` デプロイ手順書追加（日本語）
  - 環境変数 `PORT` のサポート（既存）
- ✅ README.md にデプロイガイド追加

**改善:**
- インターネット経由でのアクセスが可能に
- 自動HTTPS対応（Render経由）
- git push による自動デプロイ

---

### Version 1.0.0 (2025-11-05)

#### 初回リリース

**実装機能:**
- ✅ WebSocketベースのリアルタイム投票システム
- ✅ 教員用コントロール画面
  - 投票開始・停止機能
  - リアルタイム投票数表示
  - 結果グラフ表示（横棒グラフ + パーセンテージ）
  - リセット機能
- ✅ 学生用投票画面
  - 2択投票UI（左側 / 右側）
  - 投票確認フィードバック
  - 結果閲覧機能
- ✅ 重複投票防止機能
- ✅ 自動再接続機能（3秒間隔）
- ✅ レスポンシブデザイン対応
- ✅ 接続状態表示

**技術実装:**
- Node.js + Express によるWebサーバー
- ws ライブラリによるWebSocket通信
- localStorage による学生ID永続化
- Set データ構造による重複投票防止
- CSS3 アニメーション・グラデーション

**ドキュメント:**
- README.md（セットアップ手順、使い方、技術仕様）
- CLAUDE.md（開発者向けガイド）
- RPD.md（要件定義書）

**既知の制限事項:**
- 同一ブラウザでの複数学生IDには未対応（localStorage共有のため）
- 投票履歴の永続化なし（サーバー再起動で消去）
- 認証機能なし（ローカルネットワーク内での使用を想定）

---

### 将来の機能追加候補

- [ ] 投票履歴のエクスポート機能（CSV、JSON）
- [ ] 複数の質問セットの管理
- [ ] 教員認証機能
- [ ] 投票時間制限機能
- [ ] ダークモード対応
- [ ] 多言語対応（英語、中国語など）
- [ ] データベース連携（MongoDB、SQLiteなど）

## ライセンス

MIT License

---

## 開発者情報

- **プロジェクト名**: Right or Left 投票システム
- **バージョン**: 1.0.0
- **開発日**: 2025年11月5日
- **目的**: 教育現場でのインタラクティブな授業支援
